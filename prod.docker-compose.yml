# This docker compose starts the Balancia application in production mode.

version: "3.9"
services:
  balancia-client:
    build:
      context: ${BALANCIA_ROOT:-.}
      dockerfile: apps/client/Dockerfile
      target: builder
    image: balancia-client:latest
    volumes:
      - ${BALANCIA_ROOT:-.}/apps/client/dist:/output
    command: sh -c "echo 'Checking dist folder...' && ls -la /app/apps/client/dist && echo 'Copying files...' && cp -r /app/apps/client/dist/. /output/ && echo 'Copy complete!' && ls -la /output && sleep infinity"
    networks:
      - "balancia_network"

  balancia-server:
    build:
      context: ${BALANCIA_ROOT:-.}
      dockerfile: apps/server/Dockerfile
    image: balancia-server:latest
    env_file:
      - ${BALANCIA_ROOT:-.}/apps/server/.env
    networks:
      - "balancia_network"
    environment:
      CI: true

networks:
  balancia_network:
    external: true
