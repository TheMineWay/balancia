CREATE MATERIALIZED VIEW "finances"."account_monthly_stats" WITH (autovacuum_enabled = true) AS (select "finances"."accounts"."id", "finances"."accounts"."userId", EXTRACT(MONTH FROM "finances"."transactions"."performedAt") as "month", sum("finances"."transactions"."amount") as "monthlyBalance", sum(CASE WHEN "finances"."transactions"."amount" > 0 THEN "finances"."transactions"."amount" ELSE 0 END) as "income", sum(CASE WHEN "finances"."transactions"."amount" < 0 THEN "finances"."transactions"."amount" ELSE 0 END) as "outcome" from "finances"."accounts" inner join "finances"."transactions" on "finances"."transactions"."accountId" = "finances"."accounts"."id" group by "finances"."accounts"."id", "month");